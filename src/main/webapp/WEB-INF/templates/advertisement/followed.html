<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:include="fragments/header :: header" />
<body>
	<header class="header" th:include="fragments/menu :: menu" />
	<section id="main-section" class="container-fluid">
		<h1 th:text="#{title.advertisement.followed}">Followed Advertisement list</h1>
		<p>This view allows you to visualize all the followed advertisements added
			to this site.</p>
		<div class="container">
			<div class="row">
				<div class="col-md-4" th:each="advertisement, iter : ${entities}">
					<!--  basicamente a partir de aqui filtrar todo por si se esta en followed o no -->
					<div th:with="follows=${follows}">
						<div th:with="username=${advertisement?.userA.username}">
							<div th:if="${#sets.contains(follows, username)}">
								<div class="photo image-background">
									<div th:id="'carousel' + ${iter.index}" class="carousel slide"
										data-interval="false">
										<!-- Wrapper for slides -->
										<div class="carousel-inner">
											<!-- Resto de imagenes -->
											<div th:each="image, iterstat : ${advertisement?.images}"
												style="height: 350px; width: 100%;"
												th:class="${iterstat.index}== 0  ? 'carousel-item item active':'carousel-item item'">
												<img th:src="@{'data:image/jpeg;base64,'+${image?.imageBase64}}"
													class="img-responsive" alt=""
													style="margin: auto; max-height: -webkit-fill-available;" />
											</div>
											<!-- Left and right controls -->
											<a class="left carousel-control"
												th:href="@{'#carousel' + ${iter.index}}" data-slide="prev"> <span
												class="glyphicon glyphicon-chevron-left"></span> <span
												class="sr-only">Previous</span>
											</a> <a class="right carousel-control"
												th:href="@{'#carousel' + ${iter.index}}" data-slide="next"> <span
												class="glyphicon glyphicon-chevron-right"></span> <span
												class="sr-only">Next</span>
											</a>
										</div>
									</div>
								</div>
								<div class="info">
									<div class="row">
										<div class="price col-md-6">
											<h5>
												<span th:remove="tag" th:text="${advertisement?.title}">Title</span>
											</h5>
											<p>
												<span th:remove="tag" th:text="${advertisement?.description}">Description</span>
											</p>
											<div>
												<form th:id="${advertisement?.id}+form" action="#"
													th:action="@{/followAndUnfollow/follow}" method="post" role="form">
													<input type="hidden" id="followed" name="followed"
														th:value="${advertisement?.userA.username}"></input> <input
														type="hidden" id="returnUri" name="returnUri" value="followed"></input><span
														th:remove="tag" th:text="${advertisement?.userA.username}">User</span>
													<div th:if="${#sets.contains(follows, username)}">
														<button type="submit" th:id="${advertisement?.id}+follow"
															class="btn btn-danger">Unfollow</button>
													</div>
													<div th:unless="${#sets.contains(follows, username)}">
														<button type="submit" class="btn btn-primary"
															th:id="${advertisement?.id}+follow">Follow</button>
													</div>
												</form>
											</div>
											<p>
												<span th:remove="tag" th:text="${advertisement?.date}">User</span>
											</p>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</section>
	<footer>
		<div th:include="fragments/scripts :: general" />
	</footer>
</body>
</html>
